ä¸‹é¢æ˜¯åœ¨ä½ è¿™ç‰ˆæ–‡æ¡£çš„åŸºç¡€ä¸Šï¼ŒåªæŠŠ **NutritionQueryTool æ”¹æˆâ€œä¸Šç½‘æŸ¥è¥å…»æ•°æ®â€** åçš„ **å®Œæ•´ç‰ˆæœ¬**ã€‚

- é€»è¾‘ã€ç»“æ„ã€JSON æ•°æ®åº“è®¾è®¡ã€å…¶å®ƒå·¥å…·ä¸ Prompt **å…¨éƒ¨ä¿ç•™**ï¼›
- æ¨¡å‹ä»ç„¶å‡å®šä¸ºï¼š
    - å¤šæ¨¡æ€ï¼š**Qwen-VL**ï¼ˆå¦‚ qwen-vl-plusï¼‰
    - æ–‡æœ¬ï¼š**Qwen-Plus**ï¼ˆå¦‚ qwen-plusï¼‰
- å”¯ä¸€çš„å®è´¨å˜åŒ–ï¼š
    - ä¸å†ä½¿ç”¨æœ¬åœ° `nutrition_db.csv`
    - `NutritionQueryTool` æ”¹ä¸ºé€šè¿‡ HTTP / API **è”ç½‘æŸ¥è¯¢æ¯ 100g è¥å…»æ•°æ®**ï¼ˆä¾‹å¦‚è°ƒç”¨å…¬å¼€è¥å…»æ•°æ®åº“ API æˆ–ä½ è‡ªå»ºçš„åç«¯æœåŠ¡ï¼‰ã€‚

---

# ğŸ§± ä¸€ã€ç³»ç»Ÿæ¶æ„ï¼ˆJSON æ•°æ®åº“ç‰ˆæœ¬ï¼‰

```
å‰ç«¯ï¼ˆæˆ– CLIï¼‰
    â†“  å›¾ç‰‡ä¸è¯·æ±‚
åç«¯ Nutrition Agentï¼ˆLangChain + LangGraphï¼‰
    â†“
[å·¥å…·å±‚ Tools] â€”â€”ï¼ˆæ‰€æœ‰æ•°æ®é€šè¿‡å·¥å…·å¤„ç†ï¼‰
    VisionToolï¼šè¯†åˆ«èœ & ç²—ä¼°åˆ†é‡       ï¼ˆQwen-VLï¼‰
    PortionVerifyToolï¼šåˆ†é‡åˆç†æ€§æ ¡éªŒ    ï¼ˆQwen-Plusï¼‰
    NutritionQueryToolï¼šä¸Šç½‘æŸ¥æ¯ 100g è¥å…»ï¼ˆHTTP / API è”ç½‘æŸ¥è¯¢ï¼‰
    ComputeToolï¼šè®¡ç®—æ•´é¤è¥å…»
    HistoryToolï¼šè¯» JSON æ•°æ®åº“ï¼ˆæœ€è¿‘ä¸€å‘¨ï¼‰
    SaveToolï¼šå†™ JSON æ•°æ®åº“ï¼ˆè¿½åŠ ï¼‰
    NextMealToolï¼šä¸‹ä¸€é¤æ¨è            ï¼ˆQwen-Plusï¼‰
    ScoreToolï¼šæœ¬é¤è¯„åˆ† / è¶‹åŠ¿è¯„åˆ†      ï¼ˆQwen-Plusï¼‰

```

æ•°æ®åº“åªæœ‰ä¸€ä¸ªï¼š

```
db/
 â””â”€â”€ meals.json   â† ä¸»æ•°æ®åº“æ–‡ä»¶ï¼ˆä½ å­˜æ‰€æœ‰å¤© â†’ æ‰€æœ‰é¤ â†’ æ‰€æœ‰èœï¼‰

```

---

# ğŸ—ƒï¸ äºŒã€JSON æ•°æ®åº“ç»“æ„ï¼ˆæœ€ç»ˆç‰ˆï¼‰

æ•°æ®åº“æ–‡ä»¶ï¼š`db/meals.json`

```json
{
  "user_id": "user001",
  "days": [
    {
      "date": "2025-12-07",
      "daily_summary": {
        "total_calories": 0,
        "total_protein": 0,
        "total_fat": 0,
        "total_carbs": 0,
        "total_sodium": 0,
        "daily_score": 0
      },
      "meals": []
    }
  ]
}

```

ï¼ˆä½ å·²ç»ç¡®è®¤æ­¤ç»“æ„ï¼Œä¸å†èµ˜è¿°ï¼‰

---

# ğŸ› ï¸ ä¸‰ã€æŠ€æœ¯è·¯å¾„ï¼ˆå¯ä»¥ç…§åšçš„æ­¥éª¤ï¼‰

---

## æ­¥éª¤ 1ï¼šå‡†å¤‡ Python é¡¹ç›®ç›®å½•

```
ai-nutrition-agent/
â”œâ”€â”€ agent.py
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ vision_tools.py
â”‚   â”œâ”€â”€ portion_tools.py
â”‚   â”œâ”€â”€ nutrition_tools.py
â”‚   â”œâ”€â”€ compute_tools.py
â”‚   â”œâ”€â”€ db_tools.py
â”‚   â””â”€â”€ recommendation_tools.py
â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ meal_schema.py
â”‚   â””â”€â”€ tool_schema.py
â”œâ”€â”€ prompts/
â”‚   â”œâ”€â”€ vision_prompt.txt
â”‚   â”œâ”€â”€ portion_prompt.txt
â”‚   â”œâ”€â”€ score_prompt.txt
â”‚   â”œâ”€â”€ trend_prompt.txt
â”‚   â”œâ”€â”€ nextmeal_prompt.txt
â”‚   â””â”€â”€ summary_prompt.txt
â”œâ”€â”€ db/
â”‚   â””â”€â”€ meals.json  â† ä¸»æ•°æ®åº“
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py
â””â”€â”€ requirements.txt

```

> requirements.txt ä¸­éœ€è¦åŒ…æ‹¬ï¼š
> 
> - `openai`ï¼ˆQwen å…¼å®¹æ¨¡å¼ï¼‰
> - `langchain` / `langchain-core` / `langchain-community` / `langgraph`
> - `pydantic`
> - `requests`ï¼ˆ**ç”¨äºè”ç½‘æŸ¥è¯¢è¥å…»ä¿¡æ¯**ï¼‰

---

## æ­¥éª¤ 2ï¼šå®šä¹‰æ‰€æœ‰æ ¸å¿ƒ Schemaï¼ˆPydanticï¼‰

è¿™äº› Schema å’Œæ•°æ®åº“ä¸€ä¸€å¯¹åº”ï¼Œæ˜¯å¯ç›´æ¥ç”¨äºç»“æ„åŒ–è¾“å‡ºçš„æ¨èæ–¹å¼ã€‚

ä¾‹å¦‚ï¼ˆ`schemas/meal_schema.py`ï¼‰ï¼š

```python
from pydantic import BaseModel
from typing import List

class Nutrition(BaseModel):
    calories: float
    protein: float
    fat: float
    carbs: float
    sodium: float

class PortionEstimation(BaseModel):
    estimated_weight_g: float
    final_weight_g: float
    is_reasonable: bool
    reason: str

class Dish(BaseModel):
    dish_id: str
    name: str
    category: str
    portion_estimation: PortionEstimation
    nutrition_per_100g: Nutrition
    nutrition_total: Nutrition

class MealScores(BaseModel):
    current_meal_score: float
    week_adjusted_score: float

class MealAdvice(BaseModel):
    current_meal_advice: str
    week_adjusted_advice: str

class NextMealOption(BaseModel):
    title: str
    recommended_dishes: List[str]
    reason: str

class NextMealRecommendation(BaseModel):
    options: List[NextMealOption]
    overall_reason: str

class Meal(BaseModel):
    meal_id: str
    timestamp: str
    meal_type: str
    dishes: List[Dish]
    nutrition_total: Nutrition
    scores: MealScores
    advice: MealAdvice
    next_meal_recommendation: NextMealRecommendation

```

Schema æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒï¼Œä¼šç¡®ä¿ JSON è¾“å‡ºç»“æ„ç¨³å®šï¼Œä¸ä¼šä¹±ã€‚

---

## æ­¥éª¤ 3ï¼šå·¥å…· Tools çš„æŠ€æœ¯è·¯å¾„ï¼ˆæ ¸å¿ƒï¼‰

LangChain ä¸­ Tools æ˜¯æ„å»º Agent çš„åŸºæœ¬æ‰§è¡Œå•å…ƒã€‚

æˆ‘ä»¬æŒ‰ç…§ä¸šåŠ¡éœ€æ±‚ä¾æ¬¡å®ç°ã€‚

---

### âœ” Tool 1 â€” VisionToolï¼šå›¾ç‰‡ â†’ å¤šé“èœ + ç²—ä¼°åˆ†é‡ï¼ˆQwen-VLï¼‰

æ–‡ä»¶ï¼š`tools/vision_tools.py`

åŠŸèƒ½ï¼š

- è°ƒç”¨ Qwen-VL è¯†åˆ«å¤šé“èœ
- è¾“å‡ºæ¯é“èœçš„ï¼šåå­—ã€ç±»åˆ«ã€ä»½é‡ä¼°è®¡ï¼ˆå…‹ï¼‰ã€ç†ç”±

```python
from langchain.tools import tool
from pydantic import BaseModel
from typing import List
from openai import OpenAI
import json

client = OpenAI(
    api_key="YOUR_DASHSCOPE_API_KEY",
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)

class VisionInput(BaseModel):
    image_path: str

@tool(args_schema=VisionInput)
def detect_dishes_and_portions(image_path: str):
    """
    è°ƒç”¨ Qwen-VLï¼Œè¯†åˆ«èœå“ï¼Œç»™å‡ºç²—ä¼°é‡é‡ã€‚
    """
    system_prompt = open("prompts/vision_prompt.txt", "r", encoding="utf-8").read()

    with open(image_path, "rb") as f:
        img_bytes = f.read()

    resp = client.chat.completions.create(
        model="qwen-vl-plus",
        messages=[
            {"role": "system", "content": system_prompt},
            {
                "role": "user",
                "content": [
                    {"type": "input_image", "image": img_bytes},
                    {"type": "text", "text": "è¯·æ ¹æ®ä¸Šè¿°è¦æ±‚è¯†åˆ«å›¾åƒå¹¶è¾“å‡º JSONã€‚"}
                ],
            },
        ],
    )

    content = resp.choices[0].message.content
    return json.loads(content)

```

---

### âœ” Tool 2 â€” PortionVerifyToolï¼šåˆ†é‡åˆç†æ€§æ ¡éªŒï¼ˆQwen-Plusï¼‰

æ–‡ä»¶ï¼š`tools/portion_tools.py`

```python
from langchain.tools import tool
from pydantic import BaseModel
from typing import List, Dict
from openai import OpenAI
import json

client = OpenAI(
    api_key="YOUR_DASHSCOPE_API_KEY",
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)

class PortionCheckInput(BaseModel):
    dishes: List[Dict]

@tool(args_schema=PortionCheckInput)
def check_and_refine_portions(dishes: List[dict]):
    """
    æ¨¡å‹åˆ¤æ–­é‡é‡æ˜¯å¦åˆç†ï¼›ä¸åˆç†åˆ™é‡æ–°ç”Ÿæˆåˆ†é‡ã€‚
    å®Œæ•´è¾“å‡º PortionEstimationã€‚
    """
    system_prompt = open("prompts/portion_prompt.txt", "r", encoding="utf-8").read()

    resp = client.chat.completions.create(
        model="qwen-plus",
        messages=[
            {"role": "system", "content": system_prompt},
            {
                "role": "user",
                "content": json.dumps(dishes, ensure_ascii=False),
            },
        ],
    )

    content = resp.choices[0].message.content
    return json.loads(content)

```

---

### âœ” Tool 3 â€” NutritionQueryToolï¼š**ä¸Šç½‘æŸ¥æ¯ 100g è¥å…»ï¼ˆHTTP / API è”ç½‘ï¼‰**

> âš ï¸ ä¸ä¹‹å‰ç‰ˆæœ¬çš„åŒºåˆ«ï¼š
> 
> - **ä¸å†ä½¿ç”¨æœ¬åœ° `nutrition_db.csv`**
> - ä½¿ç”¨ `requests` è°ƒç”¨åœ¨çº¿è¥å…»æ•°æ®åº“æœåŠ¡ï¼ˆå¯ä»¥æ˜¯å…¬å¼€ APIï¼Œå¦‚ FoodData Centralï¼Œä¹Ÿå¯ä»¥æ˜¯ä½ è‡ªå»ºçš„åç«¯æœåŠ¡ï¼‰ï¼Œé€šè¿‡èœåæŸ¥è¯¢æ¯ 100g çš„è¥å…»ä¿¡æ¯ã€‚

æ–‡ä»¶ï¼š`tools/nutrition_tools.py`

```python
from langchain.tools import tool
from pydantic import BaseModel, Field
import requests

class NutritionQuery(BaseModel):
    dish_name: str = Field(..., description="èœåæˆ–ä¸»è¦é£Ÿæåç§°ï¼Œä¾‹å¦‚ 'å®«ä¿é¸¡ä¸' æˆ– 'chicken breast'")

@tool(args_schema=NutritionQuery)
def query_nutrition_per_100g(dish_name: str):
    """
    è”ç½‘æŸ¥è¯¢æŸé“èœ/é£Ÿæçš„æ¯100gè¥å…»ä¿¡æ¯ï¼ˆçƒ­é‡ã€è›‹ç™½è´¨ã€è„‚è‚ªã€ç¢³æ°´ã€é’ ï¼‰ã€‚
    è¿™é‡Œä»¥ä¼ªä»£ç å½¢å¼å±•ç¤ºï¼Œé€šè¿‡ HTTP è¯·æ±‚è®¿é—®åœ¨çº¿è¥å…»æ•°æ®åº“æœåŠ¡ã€‚
    """
    # ç¤ºä¾‹ï¼šä½ å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªåç«¯ APIï¼Œå°†å„ç§å…¬å¼€è¥å…»æ•°æ®æºå°è£…èµ·æ¥
    # å‡è®¾æœ‰ä¸€ä¸ªæœåŠ¡ï¼šGET https://your-nutrition-api.com/search?query={dish_name}
    # è¿”å›æ ¼å¼ï¼š
    # {
    #   "calories": 230,
    #   "protein": 15,
    #   "fat": 10,
    #   "carbs": 20,
    #   "sodium": 800
    # }

    url = "https://your-nutrition-api.com/search"
    params = {"query": dish_name}
    resp = requests.get(url, params=params, timeout=10)

    if resp.status_code != 200:
        # ä½ å¯ä»¥åœ¨è¿™é‡ŒæŠ›å¼‚å¸¸æˆ–è¿”å›ä¸€ä¸ªå¸¦é”™è¯¯ä¿¡æ¯çš„ç»“æ„
        raise RuntimeError(f"è¥å…»æŸ¥è¯¢æ¥å£è°ƒç”¨å¤±è´¥, status={resp.status_code}")

    data = resp.json()

    # è¿™é‡Œå‡è®¾ data å·²ç»æ˜¯æ ‡å‡†å­—æ®µï¼›å¦‚æœä¸æ˜¯ï¼Œä½ éœ€è¦åšä¸€æ¬¡å­—æ®µæ˜ å°„
    return {
        "calories": float(data["calories"]),
        "protein": float(data["protein"]),
        "fat": float(data["fat"]),
        "carbs": float(data["carbs"]),
        "sodium": float(data["sodium"])
    }

```

> è¯´æ˜ï¼š
> 
> - çœŸæ­£è½åœ°æ—¶ï¼Œä½ å¯ä»¥ï¼š
>     - ç›´æ¥è°ƒç”¨å®˜æ–¹è¥å…»æ•°æ®åº“ APIï¼ˆå¦‚ USDA FoodData Centralï¼‰ï¼›
>     - æˆ–è€…è‡ªå·±å†™ä¸€ä¸ªåŒæ­¥/ç¼“å­˜è„šæœ¬ï¼ŒæŠŠå…¬å¼€æ•°æ®çŒå…¥ä½ è‡ªå·±çš„â€œå°æœåŠ¡â€ï¼Œå†é€šè¿‡ä¸Šé¢çš„æ–¹å¼æŸ¥è¯¢ã€‚
> - å¯¹äº LLM æ¥è¯´ï¼Œå®ƒåªå…³å¿ƒè¿™ä¸ª Tool è¿”å›æ ‡å‡† JSON å­—æ®µå³å¯ã€‚

---

### âœ” Tool 4 â€” ComputeToolï¼šè®¡ç®—æ•´é¤è¥å…»

æ–‡ä»¶ï¼š`tools/compute_tools.py`

```python
from langchain.tools import tool
from typing import List, Dict

@tool
def compute_meal_nutrition(dishes: List[Dict]):
    """
    final_weight Ã— æ¯100gè¥å…» â†’ æ¯é“èœè¥å…»ï¼Œå¹¶æ±‡æ€»æ•´é¤è¥å…»ã€‚
    """
    total = {"calories": 0.0, "protein": 0.0, "fat": 0.0, "carbs": 0.0, "sodium": 0.0}

    for dish in dishes:
        w = dish["portion_estimation"]["final_weight_g"]
        per100 = dish["nutrition_per_100g"]

        nutrition_total = {
            k: per100[k] * (w / 100.0)
            for k in ["calories", "protein", "fat", "carbs", "sodium"]
        }
        dish["nutrition_total"] = nutrition_total

        for k in total:
            total[k] += nutrition_total[k]

    return {
        "dishes": dishes,
        "meal_nutrition_total": total
    }

```

---

### âœ” Tool 5 â€” load_recent_mealsï¼šè¯»å–æœ€è¿‘ 7 å¤© JSON æ•°æ®

æ–‡ä»¶ï¼š`tools/db_tools.py`

```python
from langchain.tools import tool
import json
import os
from datetime import datetime, timedelta

DB_PATH = "db/meals.json"

def _load_json():
    if not os.path.exists(DB_PATH):
        return {"user_id": "user001", "days": []}
    with open(DB_PATH, "r", encoding="utf-8") as f:
        return json.load(f)

@tool
def load_recent_meals(days: int = 7):
    db = _load_json()
    today = datetime.utcnow().date()
    cutoff = today - timedelta(days=days)

    recent_days = [
        d for d in db.get("days", [])
        if datetime.strptime(d["date"], "%Y-%m-%d").date() >= cutoff
    ]
    return {"days": recent_days}

```

---

### âœ” Tool 6 â€” save_mealï¼šå°†æœ¬é¤å†™å…¥ JSON æ•°æ®åº“

```python
from langchain.tools import tool
from datetime import datetime

def _save_json(db):
    with open(DB_PATH, "w", encoding="utf-8") as f:
        json.dump(db, f, ensure_ascii=False, indent=2)

def _update_daily_summary(day):
    # éå† day["meals"] é‡æ–°ç´¯ç§¯ daily_summary
    summary = {
        "total_calories": 0.0,
        "total_protein": 0.0,
        "total_fat": 0.0,
        "total_carbs": 0.0,
        "total_sodium": 0.0,
        "daily_score": 0.0,
    }
    for meal in day.get("meals", []):
        nt = meal["nutrition_total"]
        summary["total_calories"] += nt["calories"]
        summary["total_protein"] += nt["protein"]
        summary["total_fat"] += nt["fat"]
        summary["total_carbs"] += nt["carbs"]
        summary["total_sodium"] += nt["sodium"]
        summary["daily_score"] += meal["scores"]["week_adjusted_score"]
    if day.get("meals"):
        summary["daily_score"] /= len(day["meals"])
    day["daily_summary"] = summary

@tool
def save_meal(meal: dict):
    db = _load_json()
    ts = meal["timestamp"]
    date_str = ts.split("T")[0] if "T" in ts else ts[:10]

    # æ‰¾å¯¹åº” date
    day = next((d for d in db["days"] if d["date"] == date_str), None)
    if day is None:
        day = {
            "date": date_str,
            "daily_summary": {
                "total_calories": 0,
                "total_protein": 0,
                "total_fat": 0,
                "total_carbs": 0,
                "total_sodium": 0,
                "daily_score": 0
            },
            "meals": []
        }
        db["days"].append(day)

    day["meals"].append(meal)
    _update_daily_summary(day)
    _save_json(db)
    return "ok"

```

---

### âœ” Tool 7 â€” NextMealToolï¼šä¸‹ä¸€é¤æ¨èï¼ˆQwen-Plusï¼‰

æ–‡ä»¶ï¼š`tools/recommendation_tools.py`

```python
from langchain.tools import tool
from openai import OpenAI
import json

client = OpenAI(
    api_key="YOUR_DASHSCOPE_API_KEY",
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)

@tool
def recommend_next_meal(current_nutrition: dict, recent_history: dict):
    """
    æ ¹æ®æœ¬é¤è¥å…» + ä¸€å‘¨è¶‹åŠ¿ï¼Œç»™ä¸‹ä¸€é¤æ¨èã€‚
    """
    system_prompt = open("prompts/nextmeal_prompt.txt", "r", encoding="utf-8").read()

    payload = {
        "current_meal": current_nutrition,
        "weekly_trend": recent_history
    }

    resp = client.chat.completions.create(
        model="qwen-plus",
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "user", "content": json.dumps(payload, ensure_ascii=False)},
        ],
    )
    content = resp.choices[0].message.content
    return json.loads(content)

```

---

# ğŸ§  æ­¥éª¤ 4ï¼šAgentï¼ˆLangChain + LangGraphï¼‰ç¼–æ’æµç¨‹

æ–‡ä»¶ï¼š`agent.py`

```python
from langchain.agents import create_agent

from tools.vision_tools import detect_dishes_and_portions
from tools.portion_tools import check_and_refine_portions
from tools.nutrition_tools import query_nutrition_per_100g
from tools.compute_tools import compute_meal_nutrition
from tools.db_tools import load_recent_meals, save_meal
from tools.recommendation_tools import recommend_next_meal
# ä»¥åŠè¯„åˆ†ç›¸å…³å·¥å…·ï¼ˆæœ¬é¤è¯„åˆ†ã€è¶‹åŠ¿è¯„åˆ†ï¼‰ï¼Œè¿™é‡Œç•¥

tools = [
    detect_dishes_and_portions,
    check_and_refine_portions,
    query_nutrition_per_100g,
    compute_meal_nutrition,
    load_recent_meals,
    recommend_next_meal,
    save_meal,
    # ScoreTool ç³»åˆ—ä¹Ÿå¯ä»¥ä½œä¸º tool æ³¨å†Œ
]

system_prompt = "ä½ æ˜¯ä¸€ä¸ªè¥å…»åˆ†æ Agentï¼Œä¼šæ ¹æ®å›¾ç‰‡å’Œå†å²é¥®é£Ÿï¼Œè°ƒç”¨å·¥å…·å®Œæˆè¯†åˆ«ã€è¥å…»è®¡ç®—ä¸å»ºè®®ç”Ÿæˆã€‚"

llm_text_model = "qwen-plus"  # é€šè¿‡ LangChain åŒ…è£… Qwen-Plusï¼Œç•¥

agent = create_agent(
    model=llm_text_model,
    tools=tools,
    system_prompt=system_prompt,
)

graph = agent   # ä¾› LangGraph CLI ä½¿ç”¨

```

---

# ğŸ” æ­¥éª¤ 5ï¼šå®Œæ•´æ‰§è¡Œé“¾è·¯ï¼ˆAgent è‡ªåŠ¨è°ƒç”¨ Toolsï¼‰

å½“ä½ è°ƒç”¨ Agentï¼š

```
â€œè¿™æ˜¯æˆ‘ä¸­åˆçš„é¤ç›˜å›¾ç‰‡ï¼Œè¯·åˆ†æã€‚â€

```

Agent è‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹é“¾ï¼š

1. `detect_dishes_and_portions`ï¼ˆQwen-VLï¼šè¯†åˆ«å¤šé“èœ + ç²—åˆ†é‡ï¼‰
2. `check_and_refine_portions`ï¼ˆQwen-Plusï¼šæ ¡éªŒ/ä¿®æ­£åˆ†é‡ï¼‰
3. å¯¹æ¯é“èœè°ƒç”¨ `query_nutrition_per_100g`ï¼ˆ**è”ç½‘æŸ¥è¥å…»æ•°æ®**ï¼‰
4. `compute_meal_nutrition`ï¼ˆæ•´é¤è¥å…»æ±‡æ€»ï¼‰
5. `load_recent_meals`ï¼ˆè¯»å–æœ€è¿‘ 7 å¤©è®°å½•ï¼‰
6. è°ƒç”¨è¯„åˆ†ç›¸å…³ Tool ç”Ÿæˆæœ¬é¤è¯„åˆ† + è¶‹åŠ¿è¯„åˆ†
7. `recommend_next_meal`ï¼ˆä¸‹ä¸€é¤æ¨èï¼‰
8. `save_meal`ï¼ˆå†™å…¥ JSON æ•°æ®åº“ï¼‰

LLM è´Ÿè´£ï¼š

- æ¨ç†
- å»ºè®®
- è¯„åˆ†
- å°†å¤šä¸ªå·¥å…·ç»“æœæ•´åˆä¸ºæœ€ç»ˆè¾“å‡º

Tools è´Ÿè´£ï¼š

- å›¾åƒè¯†åˆ«
- è”ç½‘æŸ¥è¥å…»
- è®¡ç®—é€»è¾‘
- JSON æ•°æ®åº“å­˜å‚¨ä¸è¯»å–
- ä¸‹ä¸€é¤æ¨èè°ƒç”¨

---

# ğŸ’¾ æ­¥éª¤ 6ï¼šä»…ç”¨ JSON æ•°æ®åº“çš„è½åœ°åŸåˆ™

å†™å…¥è§„åˆ™ã€å¹¶å‘ã€æ–‡ä»¶æ‹†åˆ†ç­–ç•¥ä¸ä¹‹å‰ä¿æŒä¸€è‡´ï¼Œè¿™é‡Œä¸å†é‡å¤ã€‚

---

# ğŸš€ æœ€ç»ˆæ•ˆæœï¼ˆä»å›¾ç‰‡åˆ° JSON æ•°æ®åº“ï¼‰

```
å›¾ç‰‡ â†’ï¼ˆVisionToolï¼‰
å¤šé“èœè¯†åˆ« â†’ï¼ˆVisionToolï¼‰
åˆ†é‡åˆç†æ€§ â†’ï¼ˆPortionVerifyToolï¼‰
æ¯100gè¥å…»ï¼ˆè”ç½‘æŸ¥è¯¢ï¼‰ â†’ï¼ˆNutritionQueryToolï¼‰
æ•´é¤è¥å…» â†’ï¼ˆComputeToolï¼‰
ä¸€å‘¨è¶‹åŠ¿ â†’ï¼ˆHistoryToolï¼‰
æœ¬é¤è¯„åˆ† + è¶‹åŠ¿è¯„åˆ† â†’ï¼ˆScoreTool + Qwen-Plusï¼‰
ä¸‹ä¸€é¤æ¨è â†’ï¼ˆNextMealToolï¼‰
å†™å…¥ JSON æ•°æ®åº“ â†’ï¼ˆSaveMealToolï¼‰

```

å®Œå…¨ç¬¦åˆï¼š

- LangChain 1.0 ç»“æ„
- Agent + Tools æ¶æ„
- Real-world å¯è½åœ°æ–¹æ¡ˆ
- **è¥å…»ä¿¡æ¯æ¥è‡ªäº’è”ç½‘ï¼Œè€Œä¸æ˜¯æœ¬åœ° CSV**
- åªç”¨ä¸€ä¸ª JSON æ–‡ä»¶ä½œä¸ºä½ çš„æœ¬åœ°â€œé¥®é£Ÿå†å²æ•°æ®åº“â€

---